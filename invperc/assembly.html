---
layout: lesson
subtitle: Assembly
title: Program Design
prev: invperc/ties.html
next: invperc/bugs.html
uplink: invperc/index.html
pdf: invperc/assembly.pdf
ppt: invperc/assembly.ppt
youtube: {"slug": "gLO17z28SYw", "time": "00:09:48.10"}
---
<div class="transcript">
  <div class="media">
    <img class="media-object pull-left" src="assembly/001.png" />
    <p class="media-body">Hello, and welcome to the seventh episode of the Software Carpentry lecture on program design using invasion percolation as an example.  In this episode, we'll see how to assemble the bits and pieces we've already developed to create a working program.</p>
  </div>
  <div class="media">
    <img class="media-object pull-left" src="assembly/002.png" />
    <p class="media-body">As you recall, we now know how to:</p>
  </div>
  <div class="media">
    <img class="media-object pull-left" src="assembly/003.png" />
    <p class="media-body">create a grid&hellip;</p>
  </div>
  <div class="media">
    <img class="media-object pull-left" src="assembly/004.png" />
    <p class="media-body">fill it with random numbers&hellip;</p>
  </div>
  <div class="media">
    <img class="media-object pull-left" src="assembly/005.png" />
    <p class="media-body">mark cells that have been filled&hellip;</p>
  </div>
  <div class="media">
    <img class="media-object pull-left" src="assembly/006.png" />
    <p class="media-body">find cells that might be filled next&hellip;</p>
  </div>
  <div class="media">
    <img class="media-object pull-left" src="assembly/007.png" />
    <p class="media-body">&hellip;and choose one of them at random.</p>
  </div>
  <div class="media">
    <img class="media-object pull-left" src="assembly/008.png" />
    <p class="media-body">It's time to put everything together.</p>
  </div>
  <div class="media">
    <img class="media-object pull-left" src="assembly/009.png" />
    <p class="media-body">We're going to show you this code in exactly the order we would write it.</p>
  </div>
  <div class="media">
    <img class="media-object pull-left" src="assembly/010.png" />
    <p class="media-body">We start at the top and work down&hellip;</p>
  </div>
  <div class="media">
    <img class="media-object pull-left" src="assembly/011.png" />
    <p class="media-body">&hellip;introducing functions and variables as we need them&hellip;</p>
  </div>
  <div class="media">
    <img class="media-object pull-left" src="assembly/012.png" />
    <p class="media-body">&hellip;and tidy up a little bit along the way.  In the next-but-one episode of this lecture, we'll do a bit more tidying up as well.</p>
  </div>
  <div class="media">
    <img class="media-object pull-left" src="assembly/013.png" />
    <p class="media-body">Here's the first code that we write.  We start with a documentation string to remind ourselves of what this program does, we import the libraries we need, and then we create the main driver.</p>
  </div>
  <div class="media">
    <img class="media-object pull-left" src="assembly/014.png" />
    <p class="media-body">Note that we're importing the entire random number generation library instead of just the functions that we need.  This will make things easier to understand in future when we come back to revise the program.</p>
  </div>
  <div class="media">
    <img class="media-object pull-left" src="assembly/015.png" />
    <p class="media-body">The first thing we need to do in our main driver is get parameters from the command line.  We get all but the first element of <code>sys.argv</code> and store it in the variable <code>arguments</code>.  If you recall, <code>sys.argv[0]</code> is the name of the program, and we don't need that.  We then convert the first three values in <code>arguments</code> to integers, and assign them to <code>grid_size</code>, <code>value_range</code>, and <code>random_seed</code>.  If we get an <code>IndexError</code>, it means that one of the indices 0, 1, or 2 wasn't valid, so we don't have enough arguments.  If we get a <code>ValueError</code>, it means that one of our attempts to convert a string to an integer failed, so again we print an error message.</p>
  </div>
  <div class="media">
    <img class="media-object pull-left" src="assembly/016.png" />
    <p class="media-body">Notice that we've used a function called <code>fail</code> to report errors.  We haven't written this yet, so now's a good time to go back and do that.</p>
  </div>
  <div class="media">
    <img class="media-object pull-left" src="assembly/017.png" />
    <p class="media-body">Here it is.  We give it a docstring, because every function should have one; we print the error message to standard error, so that it will appear on the user's console, and then we exit from the program.</p>
  </div>
  <div class="media">
    <img class="media-object pull-left" src="assembly/018.png" />
    <p class="media-body">The box in the lower right shows the structure of the program so far.  We've got a documentation string, our <code>fail</code> function, and then the main driver of our program.</p>
  </div>
  <div class="media">
    <img class="media-object pull-left" src="assembly/019.png" />
    <p class="media-body">The next step is to run the simulation.  We do that by seeding the random number generator, creating a random grid, marking the center cell as filled, and then filling the rest of the grid.</p>
  </div>
  <div class="media">
    <img class="media-object pull-left" src="assembly/020.png" />
    <p class="media-body">In this code, we've used three functions that don't exist yet, so we're going to have to go back and write them.  Before we do that, though, let's finish off the main body of the program.</p>
  </div>
  <div class="media">
    <img class="media-object pull-left" src="assembly/021.png" />
    <p class="media-body">The last task we have is to report results.</p>
  </div>
  <div class="media">
    <img class="media-object pull-left" src="assembly/022.png" />
    <p class="media-body">But we haven't actually decided what to do about this. Nothing in our specification told us whether we were supposed to draw the fractal, calculate some statistics, or do something else entirely.  </p>
  </div>
  <div class="media">
    <img class="media-object pull-left" src="assembly/023.png" />
    <p class="media-body">For now, we'll just count the number of cells we've filled in, and print that.</p>
  </div>
  <div class="media">
    <img class="media-object pull-left" src="assembly/024.png" />
    <p class="media-body">Here's the code.  We will change <code>fill_grid</code> so that it returns the number of cells it filled in, and then we'll print that number out&hellip;</p>
  </div>
  <div class="media">
    <img class="media-object pull-left" src="assembly/025.png" />
    <p class="media-body">&hellip;except we'll add one to the value returned by <code>fill_grid</code> because we marked the center cell as being filled manually.  This is a little bit clumsy: someone who hasn't read our code carefully might think&mdash;reasonably&mdash;that <code>fill_grid</code> returns the total number of cells that are filled, not one less than that.  We should go back and tidy that up later.</p>
  </div>
  <div class="media">
    <img class="media-object pull-left" src="assembly/026.png" />
    <p class="media-body">Here's the code to create a random grid.  It checks that the parameters it's been passed make sense, and then it builds a list of lists of random values.</p>
  </div>
  <div class="media">
    <img class="media-object pull-left" src="assembly/027.png" />
    <p class="media-body">A little documentation would help here&mdash;let's go back and add a docstring.</p>
  </div>
  <div class="media">
    <img class="media-object pull-left" src="assembly/028.png" />
    <p class="media-body"><code>create_random_grid</code> returns an N&times;N grid of random values in 1 to Z.  It assumes that the random number generator has already been seeded, i.e., it is not going to seed the random number generator itself.</p>
  </div>
  <div class="media">
    <img class="media-object pull-left" src="assembly/029.png" />
    <p class="media-body">The box in the lower right shows where we put this function in our program file.</p>
  </div>
  <div class="media">
    <img class="media-object pull-left" src="assembly/030.png" />
    <p class="media-body">The next step is the function <code>mark_filled</code>, which marks a grid cell as being filed.  The docstring says that, and then we use assertions to test that the X and Y coordintaes we've been given are actually in bounds.  You might think we don't need this code, because if the X or Y coordinate is out of bounds, Python will fail and print its own error message, but there are three reasons to put these assertions in.  The first is documentation: this says (better than a comment) what we expect of X and Y.  The second is, these error messages are more meaningful that Python's generic "IndexError: index out of range" message. The third reason to put these assertions in is that some values of X and Y that we think of as illegal will actually work as indices in the grid.  If X or Y is negative, then they will count down from the end of the grid, rather than up from the beginning.  Python is quite happy to do this, but it almost certainly indicates an error somewhere in our program.  The last line in this function assigns -1 to <code>grid[x][y]</code>.</p>
  </div>
  <div class="media">
    <img class="media-object pull-left" src="assembly/031.png" />
    <p class="media-body">We're using -1 to indicate filled cells, but we don't know if people are going to remember that when they're reading our code.  If you say "grid at X, Y assigned -1", it's not immediately clear what you're doing.  So let's make a small change right now.</p>
  </div>
  <div class="media">
    <img class="media-object pull-left" src="assembly/032.png" />
    <p class="media-body">Near the top of our program we'll create a variable called <code>FILLED</code>, and give <em>it</em> the value -1, so that in our function, we can say "grid at X, Y is assigned FILLED".  <code>FILLED</code> is written in capital letters because we think of it as a constant, and by convention, constants are normally written in all caps.</p>
  </div>
  <div class="media">
    <img class="media-object pull-left" src="assembly/033.png" />
    <p class="media-body">Once again, the box in the lower right shows us the structure of our file.  The constant goes near the top of the program, because that's where people will expect to find it, and our <code>mark_filled</code> function goes in the middle.</p>
  </div>
  <div class="media">
    <img class="media-object pull-left" src="assembly/034.png" />
    <p class="media-body">The next function in our to-do list is <code>fill_grid</code>.  The docstring says that it fills an N&times;N grid until the filled region hits the boundary. It assumes that the center cell has been filled before the function is called.</p>
  </div>
  <div class="media">
    <img class="media-object pull-left" src="assembly/035.png" />
    <p class="media-body">We begin by setting up the variables <code>N</code> and <code>num_filled</code>.  <code>N</code> is the grid size, and <code>num_filled</code> is the number of cells that this function has filled so far.  We've squeezed these two variables onto one line so that our function will fit on a media.  In a real program, we'd put each one on a separate line.</p>
  </div>
  <div class="media">
    <img class="media-object pull-left" src="assembly/036.png" />
    <p class="media-body">We then go into what looks like an infinite loop.  The loop guard is "while TRUE", and since <code>True</code> is always true, this will never exit.  However, in Python and most other languages, anything that looks like a deliberate infinite loop almost always signals a loop that exits in the middle.</p>
  </div>
  <div class="media">
    <img class="media-object pull-left" src="assembly/037.png" />
    <p class="media-body">And in fact that's the case.  Down near the bottom of this loop we test a condition and use <code>break</code> to break out of that loop if this condition is true.  This is a very common idiom.</p>
  </div>
  <div class="media">
    <img class="media-object pull-left" src="assembly/038.png" />
    <p class="media-body">Inside the loop, we call another function, <code>find_candidates</code>, to find the set of candidates for filling.  This function hasn't been written yet, so we add it to our to-do list.</p>
  </div>
  <div class="media">
    <img class="media-object pull-left" src="assembly/039.png" />
    <p class="media-body">We then check that the set of candidates is non-empty, because if we haven't found any candidates for filling, something has probably gone wrong with our program.</p>
  </div>
  <div class="media">
    <img class="media-object pull-left" src="assembly/040.png" />
    <p class="media-body">And then, as discussed in a previous episode, we convert the set of candidates to a list, make a random choice to find the (x,y) coordinates of the cell we're going to fill, and then we mark that cell as filled, and increment our count of the number of cells we've filled so far.</p>
  </div>
  <div class="media">
    <img class="media-object pull-left" src="assembly/041.png" />
    <p class="media-body">We then check to see whether either the X or the Y coordinate is on the boundaries of the grid.  If it is, we break out of our loop&hellip;</p>
  </div>
  <div class="media">
    <img class="media-object pull-left" src="assembly/042.png" />
    <p class="media-body">&hellip;and return the number of cells that we've filled.</p>
  </div>
  <div class="media">
    <img class="media-object pull-left" src="assembly/043.png" />
    <p class="media-body">Again, the box in the lower right shows where this function fits in the file.</p>
  </div>
  <div class="media">
    <img class="media-object pull-left" src="assembly/044.png" />
    <p class="media-body">One more function.  <code>find_candidates</code> finds low-valued neighbor cells and returns them as a set. <code>N</code> is assigned the size of the grid, <code>min_val</code> and <code>min_set</code> are initialized as discussed in an earlier episode, and then we loop over the X and Y coordinates, checking to see if the neighbors of the cell we're looking at are already filled.</p>
  </div>
  <div class="media">
    <img class="media-object pull-left" src="assembly/045.png" />
    <p class="media-body">We're going to stop right there.</p>
  </div>
  <div class="media">
    <img class="media-object pull-left" src="assembly/046.png" />
    <p class="media-body">This code is already hard to read.</p>
  </div>
  <div class="media">
    <img class="media-object pull-left" src="assembly/047.png" />
    <p class="media-body">In fact, it contains a bug.</p>
  </div>
  <div class="media">
    <img class="media-object pull-left" src="assembly/048.png" />
    <p class="media-body">That <code>y+1</code> should be <code>y-1</code>, but you probably didn't notice that because there was too much code to read at once.</p>
  </div>
  <div class="media">
    <img class="media-object pull-left" src="assembly/049.png" />
    <p class="media-body">A good rule of thumb is, "Listen to your code as you write it."  If the code is difficult to understand when read aloud, then it's probably going to be difficult to understand when you're debugging, so you should try to simplify it.</p>
  </div>
  <div class="media">
    <img class="media-object pull-left" src="assembly/050.png" />
    <p class="media-body">This version of <code>find_candidates</code> introduces a helper function called <code>is_candidate</code>.</p>
  </div>
  <div class="media">
    <img class="media-object pull-left" src="assembly/051.png" />
    <p class="media-body">This is much clearer when read aloud.</p>
  </div>
  <div class="media">
    <img class="media-object pull-left" src="assembly/052.png" />
    <p class="media-body">If the cell at (x,y) is a candidate, then we check to see whether it ties with the current lowest value or is a new lowest value.  If it ties with the lowest value, we add its coordinates to the set.  If it's a new lowest value, then we re-initialize <code>min_val</code> and <code>min_set</code> as discussed in an earlier episode.</p>
  </div>
  <div class="media">
    <img class="media-object pull-left" src="assembly/053.png" />
    <p class="media-body">As you can see, the <code>find_candidates</code> function fits right above <code>fill_grid</code> in our file.</p>
  </div>
  <div class="media">
    <img class="media-object pull-left" src="assembly/054.png" />
    <p class="media-body">We can then insert the <code>is_candidate</code> function, which has the tests we discussed in the previous episode, right above <code>find_candidates</code>.</p>
  </div>
  <div class="media">
    <img class="media-object pull-left" src="assembly/055.png" />
    <p class="media-body">It's finally time to run our program.  But actually, it isn't.</p>
  </div>
  <div class="media">
    <img class="media-object pull-left" src="assembly/056.png" />
    <p class="media-body">It's finally time to <em>test</em> our program.</p>
  </div>
  <div class="media">
    <img class="media-object pull-left" src="assembly/057.png" />
    <p class="media-body">Because there's a bug lurking in the code that we just put together.</p>
  </div>
  <div class="media">
    <img class="media-object pull-left" src="assembly/058.png" />
    <p class="media-body">Take a moment now, read over the code, and try to find the bug before moving on to the next episode.</p>
  </div>
  <div class="media">
    <img class="media-object pull-left" src="assembly/059.png" />
    <p class="media-body">Thank you.</p>
  </div>
</div>
